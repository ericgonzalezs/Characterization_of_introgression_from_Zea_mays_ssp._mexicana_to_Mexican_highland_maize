#PBS -N SNP_filter
#PBS -l nodes=1:ppn=1,vmem=30gb,walltime=250:00:00
#PBS -q default
#PBS -V

cd $PBS_O_WORKDIR

NP=$(wc -l < $PBS_NODEFILE)

module load bcftools/1.3.1

bcftools query -f '%CHROM\t%POS[\t%TGT]\n'  -e 'N_ALT!=1' CML457_sitios_PTs_1261.vcf.gz | sed -e 's/\///g' -e 's/\./N/g' > CML457_sitios_PTs_1261.geno

bcftools query -f '%CHROM\t%POS[\t%TGT]\n'  -e 'N_ALT!=1' 1261_PTs_MQ30_BQ20_SNPs_filtered_GQ20_DP10_sitios_457.vcf.gz | sed -e 's/\///g' -e 's/\./N/g' > 1261_PTs_MQ30_BQ20_SNPs_filtered_GQ20_DP10_sitios_457.geno

perl convertDoGeno2egglib.pl CML457_sitios_PTs_1261.geno > CML457_sitios_PTs_1261.geno.txt

perl convertDoGeno2egglib.pl 1261_PTs_MQ30_BQ20_SNPs_filtered_GQ20_DP10_sitios_457.geno > 1261_PTs_MQ30_BQ20_SNPs_filtered_GQ20_DP10_sitios_457.geno.txt


awk -F"\t" -v OFS="\t" '{print $1, $2}' 1261_PTs_MQ30_BQ20_SNPs_filtered_GQ20_DP10_sitios_457.geno.txt > 1261_PTs_MQ30_BQ20_SNPs_filtered_GQ20_DP10_sitios_457_para_filtrarvcf.txt


awk -F"\t" -v OFS="\t" '{print $1, $2}' CML457_sitios_PTs_1261.geno.txt > CML457_sitios_PTs_1261__para_filtrarvcf.txt

zcat 1261_PTs_MQ30_BQ20_SNPs_filtered_GQ20_DP10_sitios_457.vcf.gz | grep -w -f 1261_PTs_MQ30_BQ20_SNPs_filtered_GQ20_DP10_sitios_457_para_filtrarvcf.txt > 1261_PTs_MQ30_BQ20_SNPs_filtered_GQ20_DP10_sitios_457_ALLALT1.vcf

zcat CML457_sitios_PTs_1261.vcf.gz | grep -w -f CML457_sitios_PTs_1261__para_filtrarvcf.txt > CML457_sitios_PTs_1261__ALLALT1.vcf

awk -F "\t" '{print "S"$1"_"$2}' 1261_PTs_MQ30_BQ20_SNPs_filtered_GQ20_DP10_sitios_457.geno.txt > col1_1261_PTs_MQ30_BQ20_SNPs_filtered_GQ20_DP10_sitios_457.txt

awk -F "\t" '{print "S"$1"_"$2}' CML457_sitios_PTs_1261.geno.txt > col1_CML457_sitios_PTs_1261.txt

awk -F"\t" '{print $4"/"$5}' CML457_sitios_PTs_1261__ALLALT1.vcf > col2_CML457_sitios_PTs_1261.txt

awk -F"\t" '{print $4"/"$5}' 1261_PTs_MQ30_BQ20_SNPs_filtered_GQ20_DP10_sitios_457_ALLALT1.vcf > col2_1261_PTs_MQ30_BQ20_SNPs_filtered_GQ20_DP10_sitios_457.txt

awk -F"\t" -v OFS="\t" '{print $1, $2, "+", "NA", "NA", "NA", "NA", "NA", "NA", $3}' CML457_sitios_PTs_1261.geno.txt > CML457_sitios_PTs_1261.preHapmap.txt

paste -d"\t" col1_CML457_sitios_PTs_1261.txt col2_CML457_sitios_PTs_1261.txt CML457_sitios_PTs_1261.preHapmap.txt > CML457_sitios_PTs_1261.casiHapmap.txt

#Header for CML457 made separately from this script on a text editor
#rs#	alleles	chrom	pos	strand	assembly#	center	protLSID	assayLSID	panelLSID	QCcode	CML457

cat encabezado_paraCML.txt CML457_sitios_PTs_1261.casiHapmap.txt > CML457_sitios_PTs_1261.hmp.txt

awk -F"\t" -v OFS="\t" '{print $1, $2, "+", "NA", "NA", "NA", "NA", "NA", "NA", $3, $4, $5}' 1261_PTs_MQ30_BQ20_SNPs_filtered_GQ20_DP10_sitios_457.geno.txt > 1261_PTs_MQ30_BQ20_SNPs_filtered_GQ20_DP10_sitios_457.prehapmap

paste -d"\t" col1_1261_PTs_MQ30_BQ20_SNPs_filtered_GQ20_DP10_sitios_457.txt col2_1261_PTs_MQ30_BQ20_SNPs_filtered_GQ20_DP10_sitios_457.txt 1261_PTs_MQ30_BQ20_SNPs_filtered_GQ20_DP10_sitios_457.prehapmap > 1261_PTs_MQ30_BQ20_SNPs_filtered_GQ20_DP10_sitios_457.casihapmap.txt

#header for PTs-1261 made separately from this script on a text editor
#rs#	alleles	chrom	pos	strand	assembly#	center	protLSID	assayLSID	panelLSID	QCcode	1032.6NyV	1032.9NyV	1261

cat encabezado_paraPTsy1261.txt 1261_PTs_MQ30_BQ20_SNPs_filtered_GQ20_DP10_sitios_457.casihapmap.txt > 1261_PTs_MQ30_BQ20_SNPs_filtered_GQ20_DP10_sitios_457.hmp.txt
